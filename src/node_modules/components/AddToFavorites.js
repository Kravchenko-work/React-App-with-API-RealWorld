import React from "react";
import classNames from "classnames";

import useFetch from "hooks/useFetch";

const AddToFavorites = ({isFavorited, favoritesCount, articleSlug, isTextExist = false}) => {
    const apiUrl = `/articles/${articleSlug}/favorite`;
    const [{response, isLoading}, doFetch] = useFetch(apiUrl);

    const favoritesCountWithResponse = response ? 
        response.article.favoritesCount : favoritesCount;

    const isFavoritedWithResponse = response ?
        response.article.favorited : isFavorited;

    const handleLike = event => {
        event.preventDefault();
        if (isLoading)
            return

        doFetch({
            method: isFavoritedWithResponse ? 'delete' : 'post'
        })
    }

    const buttonClasses = classNames({
        btn: true,
        'btn-sm': true,
        'btn-primary': isFavoritedWithResponse,
        'btn-outline-primary': !isFavoritedWithResponse
    })

    return (
        <button className={buttonClasses} onClick={handleLike}>
            <i className='ion-heart'></i>
            {isTextExist &&  (
                    <span>&nbsp;
                        {isFavoritedWithResponse ? 'Unfavorite Article' : 'Favorite Article'}
                    </span>
                )
            }
            <span>&nbsp;{favoritesCountWithResponse}</span>
        </button>
    )
}

export default AddToFavorites;


